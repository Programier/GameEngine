set(OPENGL_SOURCES_DIR "${CMAKE_CURRENT_SOURCE_DIR}")
file(GLOB OPENGL_SRC "${OPENGL_SOURCES_DIR}/*.cpp")

if(WIN32)
    set(OPENGL_LIBS opengl32)
elseif(ANDROID)
    set(OPENGL_LIBS GLESv3)
else()
    set(OPENGL_LIBS GL)
endif()

if(NOT ANDROID)
    add_library(OpenGL SHARED ${OPENGL_SRC})
    target_link_libraries(OpenGL PUBLIC ${OPENGL_LIBS} glew_s TrinexEngine)

    install (TARGETS OpenGL DESTINATION ${TRINEX_LIBRARIES_INSTALL_DIR})

    target_compile_options(OpenGL PRIVATE "-Wall")
    target_compile_options(OpenGL PRIVATE "-Wno-unknown-pragmas")
    target_compile_options(OpenGL PRIVATE "-Wmismatched-tags")

    if (CMAKE_BUILD_TYPE STREQUAL "Release")
        target_compile_options(OpenGL PRIVATE "-O3")
        target_compile_options(OpenGL PRIVATE "-Os")
        target_compile_options(OpenGL PRIVATE "-finline-functions")
        target_compile_options(OpenGL PRIVATE "-funroll-loops")
        target_compile_options(OpenGL PRIVATE "-fomit-frame-pointer")
    else()
        target_compile_options(OpenGL PRIVATE "-g")
    endif()

    if(UNIX)
        target_link_options(OpenGL PUBLIC -rdynamic)
    endif()
endif()

if(NOT WIN32)
    add_library(OpenGLES SHARED ${OPENGL_SRC})
    target_compile_definitions(OpenGLES PRIVATE FORCE_USE_OPENGL_ES)
    target_link_libraries(OpenGLES PUBLIC ${OPENGL_LIBS} TrinexEngine)

    install (TARGETS OpenGLES DESTINATION ${TRINEX_LIBRARIES_INSTALL_DIR})

    target_compile_options(OpenGLES PRIVATE "-Wall")
    target_compile_options(OpenGLES PRIVATE "-Wno-unknown-pragmas")
    target_compile_options(OpenGLES PRIVATE "-Wmismatched-tags")

    if (CMAKE_BUILD_TYPE STREQUAL "Release")
        target_compile_options(OpenGLES PRIVATE "-O3")
        target_compile_options(OpenGLES PRIVATE "-Os")
        target_compile_options(OpenGLES PRIVATE "-finline-functions")
        target_compile_options(OpenGLES PRIVATE "-funroll-loops")
        target_compile_options(OpenGLES PRIVATE "-fomit-frame-pointer")
    else()
        target_compile_options(OpenGLES PRIVATE "-g")
    endif()

    if(UNIX)
        target_link_options(OpenGLES PUBLIC -rdynamic)
    endif()
endif()
